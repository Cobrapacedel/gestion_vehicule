{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="fr"
      x-data="{
          open: false,
          active: 0,
          darkMode: localStorage.getItem('darkMode') === 'enabled',
          images: [
              '{% static "images/truck1.png" %}',
              '{% static "images/moto1.png" %}',
              '{% static "images/bus1.png" %}',
              '{% static "images/voiture2.png" %}',
              '{% static "images/moto2.png" %}',
              '{% static "images/bus2.png" %}'
          ],
          toggleDarkMode() {
              this.darkMode = !this.darkMode;
              document.documentElement.classList.toggle('dark', this.darkMode);
              localStorage.setItem('darkMode', this.darkMode ? 'enabled' : 'disabled');
              lucide.createIcons();
          }
      }"
      x-init="
          if (darkMode) document.documentElement.classList.add('dark');
          setInterval(() => { active = (active + 1) % images.length }, 4000);
          updateDateTime();
          setInterval(updateDateTime, 1000);
          lucide.createIcons();
      "
      :class="{ 'dark': darkMode }">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Jere Machin Ou{% endblock %}</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>tailwind.config = { darkMode: 'class' }</script>

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}?v=1">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicon-32x32.png' %}?v=1">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon-16x16.png' %}?v=1">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-touch-icon.png' %}?v=1">
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <meta name="theme-color" content="#111827">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">

    <style>[x-cloak]{display:none!important}</style>
</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-white">
    
  {% include "core/includes/_messages.html" %}

    <!-- SÃ©lecteur de langue -->
    <form action="{% url 'set_language' %}" method="post" class="relative inline-block text-left ml-4 mt-4">
      {% csrf_token %}
      <div x-data="{ open: false }" class="relative">
        <button type="button" @click="open = !open"
          class="inline-flex justify-center items-center gap-2 rounded-md border border-gray-300 shadow-sm px-3 py-2 bg-white dark:bg-gray-800 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-gray-50 focus:outline-none">
          ğŸŒ 
          {% get_current_language as LANGUAGE_CODE %}
          {% if LANGUAGE_CODE == 'fr' %}KreyÃ²l ğŸ‡­ğŸ‡¹
          {% elif LANGUAGE_CODE == 'en' %}English ğŸ‡¬ğŸ‡§
          {% elif LANGUAGE_CODE == 'ht' %}FranÃ§ais ğŸ‡«ğŸ‡·
          {% endif %}
          <svg class="-mr-1 ml-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
          </svg>
        </button>

        <div x-show="open" @click.away="open = false"
             class="absolute right-0 mt-2 w-40 rounded-md shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 z-50">
          <ul class="py-1 text-sm">
            <li><button type="submit" name="language" value="fr" class="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">ğŸ‡«ğŸ‡· FranÃ§ais</button></li>
            <li><button type="submit" name="language" value="en" class="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">ğŸ‡¬ğŸ‡§ English</button></li>
            <li><button type="submit" name="language" value="ht" class="block w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">ğŸ‡­ğŸ‡¹ KreyÃ²l</button></li>
          </ul>
        </div>
      </div>
    </form>

    <!-- Navbar -->
    <nav class="bg-gray-900 text-white shadow-md mt-4">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <a href="{% url 'home' %}" class="flex items-center space-x-2 text-lg font-bold">
                <i class="fa-solid fa-car"></i>
                <span>Jere Machin <i class="fa-solid fa-face-smile-beam"></i>u</span>
            </a>
            <div class="space-x-4 hidden md:flex">
                {% if user.is_authenticated %}
                    <a href="{% url 'core:dashboard_redirect' %}" class="hover:underline"><i class="fa-solid fa-home"></i> AkÃ¨y</a>
                    <a href="{% url 'core:about' %}" class="hover:underline"><i class="fa-solid fa-info"></i> Apwopo</a>
                    <a href="{% url 'core:mon_cv' %}" class="hover:underline"><i class="fa-solid fa-id-card"></i> CV</a>
                    {# DEBUG #}
USER_TYPE = {{ request.user.user_type }} | ROLE = {{ request.user.role }}

{% if request.user.user_type == "business" %}
    <a href="{% url 'users:business_profile_detail' %}">Pwofil</a>
{% else %}
    <a href="{% url 'users:simple_profile_detail' %}">Pwofil</a>
{% endif %}

                    <a href="{% url 'notifications:notification_list' %}" class="relative hover:underline">
                        <i class="fa-solid fa-bell"></i> Notifikasyon Yo
                        {% if notifications %}
                            <span class="absolute top-0 -right-2 bg-red-500 text-xs rounded-full px-2">{{ notifications }}</span>
                        {% endif %}
                    </a>
                    <a href="{% url 'users:logout' %}" class="hover:underline"><i class="fa-solid fa-sign-out-alt"></i> Dekoneksyon</a>
                {% else %}
                    <a href="{% url 'users:register_choice' %}" class="hover:underline">Enskripsyon</a>
                    <a href="{% url 'login' %}" class="hover:underline">Koneksyon</a>
                {% endif %}
            </div>
            <div class="md:hidden">
                <button @click="open = !open" class="text-white"><i class="fa-solid fa-bars"></i></button>
            </div>
        </div>

        <!-- Menu mobile -->
        <div x-show="open" x-transition class="md:hidden bg-gray-900 text-white p-4 space-y-2">
            <a href="{% url 'core:dashboard_redirect' %}" class="block py-2">AkÃ¨y</a>
            <a href="{% url 'core:about' %}" class="block py-2">Apwopo</a>
            <a href="{% url 'core:mon_cv' %}" class="block py-2">CV</a>
{% if request.user.user_type == "business" %}
    <a href="{% url 'users:business_profile_detail' %}" class="block py-2">Pwofil</a>
{% else %}
    <a href="{% url 'users:simple_profile_detail' %}" class="block py-2">Pwofil</a>
{% endif %}
            <a href="{% url 'notifications:notification_list' %}" class="block py-2">Notifikasyon Yo</a>
            <a href="{% url 'users:logout' %}" class="block py-2">Dekoneksyon</a>
        </div>
    </nav>

    <!-- Messages -->
    {% if messages %}
    <div class="max-w-5xl mx-auto mt-4 space-y-2">
        {% for message in messages %}
            <div class="p-4 rounded shadow
                {% if message.tags == 'success' %} bg-green-100 text-green-800
                {% elif message.tags == 'error' %} bg-red-100 text-red-800
                {% else %} bg-blue-100 text-blue-800 {% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Contenu principal -->
    <main class="max-w-7xl mx-auto mt-6 px-4">
        {% block content %}{% endblock %}
    </main>

    <!-- Carousel -->
    <div class="relative max-w-5xl mx-auto mt-10 rounded overflow-hidden shadow-lg">
        <img :src="images[active]" alt="Image carousel"
             class="w-full aspect-[16/9] object-contain transition-all duration-700" loading="lazy">
    </div>

    <!-- Date & heure -->
    <div class="text-center mt-6 text-lg font-medium">
        <div id="date"></div>
        <div id="time"></div>
    </div>

    <!-- Bouton Dark Mode (simple, fonctionnel) -->
    <div class="fixed z-[9999] bottom-6 right-6">
        <button @click="toggleDarkMode()"
                class="w-12 h-12 rounded-full shadow-lg
                       bg-gray-900 text-white
                       dark:bg-yellow-400 dark:text-black
                       flex items-center justify-center
                       transition-all duration-300
                       hover:scale-110
                       ring-2 ring-white dark:ring-gray-900
                       cursor-pointer select-none
                       opacity-40 hover:opacity-100 focus:opacity-100">
            <i x-show="!darkMode" x-cloak data-lucide="moon"></i>
            <i x-show="darkMode"  x-cloak data-lucide="sun"></i>
        </button>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-10 py-6">
        <div class="text-center space-y-2">
            <p><i class="fa-solid fa-car"></i> <strong>Jere Machin <i class="fa-solid fa-face-smile-beam"></i>u</strong> &copy; {% now "Y" %}</p>
            <p>Tout Dwa Yo RezÃ¨ve</p>
            <p><span class="text-blue-300 font-semibold">Cobrapacedelâ„¢</span></p>
            <div class="flex flex-wrap justify-center gap-4 text-2xl mt-4">
                <a href="https://wa.me/+18294630993" target="_blank" rel="noopener noreferrer"><i class="fab fa-whatsapp"></i></a>
                <a href="https://facebook.com/cobrapacedel" target="_blank" rel="noopener noreferrer"><i class="fab fa-facebook"></i></a>
                <a href="https://discord.com/cobrapacedel" target="_blank" rel="noopener noreferrer"><i class="fab fa-discord"></i></a>
                <a href="https://github.com/cobrapacedel" target="_blank" rel="noopener noreferrer"><i class="fab fa-github"></i></a>
                <a href="https://instagram.com/cobrapacedel" target="_blank" rel="noopener noreferrer"><i class="fab fa-instagram"></i></a>
                <a href="https://twitter.com/cobrapacedel" target="_blank" rel="noopener noreferrer"><i class="fab fa-twitter"></i></a>
                <a href="https://t.me/cobrapacedel" target="_blank" rel="noopener noreferrer"><i class="fab fa-telegram"></i></a>
                <a href="https://www.tiktok.com/@cobrapacedel" target="_blank" rel="noopener noreferrer"><i class="fab fa-tiktok"></i></a>
                <a href="https://www.youtube.com/@cobrapacedel" target="_blank" rel="noopener noreferrer"><i class="fab fa-youtube"></i></a>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="{% static 'js/hrs.js' %}"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="{% static 'js/darkmode.js' %}"></script>
    <script>
console.log("ğŸš€ BASE.HTML LOADED");
</script>
<script>
const socket = new WebSocket(
    'ws://' + window.location.host + '/ws/notifications/'
);

socket.onopen = function () {
    console.log("âœ… WebSocket CONNECTÃ‰");
};

socket.onerror = function (error) {
    console.error("âŒ WebSocket ERREUR", error);
};

socket.onclose = function () {
    console.log("ğŸ”Œ WebSocket FERMÃ‰");
};

socket.onmessage = function(e) {
    console.log("ğŸ“© MESSAGE REÃ‡U", e.data);
    const data = JSON.parse(e.data);
    alert(data.title + " : " + data.message);
};
</script>
</body>
</html>
