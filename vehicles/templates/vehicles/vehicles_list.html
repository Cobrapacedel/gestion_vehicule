{% extends "core/base.html" %}
{% load static %}
{% load humanize %}

{% block title %}Lis Tout Veyikil Yo{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
  <h1 class="text-2xl font-bold mb-6">ğŸš˜ Lis Tout Veyikil Yo</h1>

  <!-- Formulaire de recherche -->
  <form method="GET" class="flex flex-wrap gap-4 mb-6">
    <div class="w-full md:w-1/4 bg-gray-100 p-4 rounded-lg shadow border border-gray-500">
      <input type="text" name="q" class="form-input p-3 border rounded-lg w-full" placeholder="ChÃ¨che ......" value="{{ request.GET.q }}">
    </div>
    <div class="w-full md:w-1/4 bg-gray-100 p-4 rounded-lg shadow border border-gray-500">
      <input type="date" name="start_date" class="form-input p-3 border rounded-lg w-full" value="{{ request.GET.start_date }}">
    </div>
    <div class="w-full md:w-1/4 bg-gray-100 p-4 rounded-lg shadow border border-gray-500">
      <input type="date" name="end_date" class="form-input p-3 border rounded-lg w-full" value="{{ request.GET.end_date }}">
    </div>
    <div class="w-full md:w-1/4 flex items-end">
      <button type="submit" class="btn btn-primary px-4 py-2 rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none">Filtre</button>
    </div>
  </form>

  <!-- ğŸš€ Boutons dâ€™action selon rÃ´le -->
  <div class="flex justify-between mb-6 mt-6">
    {% if user.role in "agency dealer garage user" %}
      <a href="{% url 'vehicles:add_vehicle' %}" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">â•</a>
    {% endif %}

    {% if user.role == "garage" %}
      <a href="{% url 'contracts:contract_list' %}" class="px-6 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition">ğŸ”§</a>
    {% endif %}
  </div>

  <!-- Tableau des vÃ©hicules -->
  <div class="overflow-x-auto bg-white rounded-lg shadow">
    <table class="w-full text-left text-sm">
      <thead class="bg-gray-100 text-black border-b font-semibold">
        <tr>
          <th class="px-4 py-3">ID</th>
          <th class="px-4 py-3">Plak</th>
          <th class="px-4 py-3">Estati</th>
          <th class="px-4 py-3">Aksyon</th>
          <th class="px-4 py-3">Tip</th>
        </tr>
      </thead>
      <tbody class="divide-y">
        {% for vehicle in vehicles %}
          <tr class="hover:bg-gray-50 text-black">
            <td class="px-4 py-2">{{ user.id }}</td>
            <td class="px-4 py-2">{{ vehicle.plate_number }}</td>
            <td class="px-4 py-2">
              {% if vehicle.status == 'available' %}
                <span class="inline-block px-2 py-1 text-xs font-medium bg-green-100 text-green-800 rounded">âœ… Aktif</span>
              {% elif vehicle.status == 'rented' %}
                <span class="inline-block px-2 py-1 text-xs font-medium bg-gray-200 text-gray-800 rounded">ğŸš— Lwe</span>
              {% elif vehicle.status == 'sold' %}
                <span class="inline-block px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 rounded">ğŸ¤ Vann</span>
              {% elif vehicle.status == 'loaned' %}
                <span class="inline-block px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded">ğŸ” Prete</span>
              {% elif vehicle.status == 'mechanic' %}
                <span class="inline-block px-2 py-1 text-xs font-medium bg-red-200 text-red-900 rounded">ğŸ”§ Garaj</span>
              {% else %}
                <span class="inline-block px-2 py-1 text-xs font-medium bg-gray-100 text-gray-700 rounded">âšª N/A</span>
              {% endif %}
            </td>
            <td class="px-4 py-2 flex gap-2">
              <a href="{% url 'vehicles:vehicle_detail' vehicle.id %}" class="text-blue-600 hover:underline">ğŸ” Detay</a>

              {% if user.role == 'agency' and vehicle.status == 'available' %}
                <a href="{% url 'contracts:contract_create' %}" class="text-green-600 hover:underline">ğŸ“„ Lwe</a>
              {% endif %}

              {% if user.role == 'dealer' and vehicle.status == 'available' %}
                <a href="{% url 'contracts:contract_create' %}" class="text-yellow-600 hover:underline">ğŸ¤ Vann</a>
              {% endif %}
              
              {% if user.role == 'user' and vehicle.status == 'available' %}
              <a href="{% url 'contracts:contract_create' %}" class="text-purple-609 hover:underline">Prete</a>
              {% endif %}
            </td>
          </tr>
        {% empty %}
          <tr>
            <td colspan="4" class="px-4 py-4 text-center text-gray-500">Pa gen machin disponib.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="mt-6 text-sm flex justify-center items-center gap-4 flex-wrap">
    {% if vehicles.has_previous %}
      <a href="?page=1" class="text-blue-600 hover:underline">&laquo; Premye</a>
      <a href="?page={{ vehicles.previous_page_number }}" class="text-blue-600 hover:underline">Anvan</a>
    {% endif %}

    <span class="text-gray-700">Paj {{ vehicles.number }} sou {{ vehicles.paginator.num_pages }}</span>

    {% if vehicles.has_next %}
      <a href="?page={{ vehicles.next_page_number }}" class="text-blue-600 hover:underline">Pwochen</a>
      <a href="?page={{ vehicles.paginator.num_pages }}" class="text-blue-600 hover:underline">DÃ¨nye &raquo;</a>
    {% endif %}
  </div>

  <!-- âª Retour -->
  <div class="mt-6">
    <a href="{% url 'core:dashboard_redirect' %}" class="text-blue-600 hover:underline">â† Retounen sou tablodbÃ² a</a>
  </div>
</div>
{% endblock %}