{% extends "core/base.html" %}
{% load static %}
{% load i18n %}
{% load humanize %}
{% load vehicle_tags %}

{% block title %}Detay | Veyikil{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  em{ color: blue; opacity: 0.6; text-shadow: 1px 1px 1px white; }
  strong { color: red; opacity: 0.6; text-shadow: 1px 1px 1px white; }
  .badge {
    padding: 0.25rem 0.5rem;
    border-radius: 0.375rem;
    font-size: 0.75rem;
    font-weight: 600;
  }
</style>

<div class="max-w-5xl mx-auto px-4 py-8">

  <!-- ðŸš— Titre principal -->
  <h1 class="text-2xl font-bold mb-6 flex items-center gap-2">
    {% vehicle_icon vehicle.vehicle_type %} {{ vehicle.brand }} {{ vehicle.model }} ({{ vehicle.plate_number|default:"â€”" }})
  </h1>

  <!-- Infos vÃ©hicule + propriÃ©taire -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 bg-white p-6 text-black rounded-lg shadow dark:bg-gray-800 dark:text-gray-100">

    <!-- ðŸ‘¤ PropriÃ©taire -->
    <div>
      <h2 class="text-lg font-semibold mb-3">
        <i class="fa-solid fa-user mr-2 text-indigo-600"></i>{% trans "PwopriyetÃ¨" %}
      </h2>

      {% if vehicle.owner.user_type == 'business' %}
        <p><strong>{% trans "Non" %} :</strong> {{ vehicle.owner.businessprofile.business_name|default:"â€”" }}</p>
        <p><strong>{% trans "Patant" %} :</strong> {{ vehicle.owner.businessprofile.patente_number|default:"â€”" }}</p>
        <p><strong>{% trans "TelefÃ²n" %} :</strong> {{ vehicle.owner.phone|default:"â€”" }}</p>
      {% else %}
        <p><strong>{% trans "Non" %} :</strong> {{ vehicle.owner.simple.first_name|default:"â€”" }} {{ vehicle.owner.simple.last_name|default:"â€”" }}</p>
        <p><strong>{% trans "Lisans" %} :</strong> {{ vehicle.owner.simple.driver_license_number|default:"â€”" }}</p>
        <p><strong>{% trans "TelefÃ²n" %} :</strong> {{ vehicle.owner.phone|default:"â€”" }}</p>
      {% endif %}

      <!-- ðŸš˜ DÃ©tails du vÃ©hicule -->
      <h2 class="text-lg font-semibold mt-4 mb-3">
        <i class="fa-solid fa-car mr-2 text-indigo-600"></i>{% trans "Detay Veyikil" %}
      </h2>
      <p><strong>{% trans "Kalite" %} :</strong> {{ vehicle.vehicle_type|vehicle_type_badge }}</p>
      <p><strong>{% trans "MotÃ¨ #" %} :</strong> {{ vehicle.serial_number|default:"N/A" }}</p>
      <p><strong>{% trans "KoulÃ¨" %} :</strong> {{ vehicle.color|default:"N/A" }}</p>
      <p><strong>{% trans "Lanne" %} :</strong> {{ vehicle.year|default:"N/A" }}</p>
      <p><strong>{% trans "Kilometray" %} :</strong> {{ vehicle.mileage|default:0|intcomma }} km <em><span>(lÃ¨ li te achte a)</span></em></p>
      <p><strong>{% trans "Kalite gaz" %} :</strong> {{ vehicle.fuel_type|fuel_type_badge }}</p>
      <p><strong>{% trans "Estati" %} :</strong> {{ vehicle.status|vehicle_status_badge }}</p>
      <p><strong>{% trans "Dat kreye" %} :</strong> {{ vehicle.created_at|date:"d/m/Y H:i" }}</p>
    </div>

    <!-- ðŸ–¼ï¸ Image -->
    <div>
      {% if vehicle.image %}
        <img src="{{ vehicle.image.url }}" alt="{{ vehicle.brand }} {{ vehicle.model }}" class="rounded-lg shadow w-full">
      {% else %}
        <div class="w-full h-64 flex items-center justify-center bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 rounded-lg">
          <i class="fa-solid fa-image text-4xl"></i>
          <span class="ml-2">Pa gen imaj</span>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- ðŸ“œ Historique -->
  <div class="mt-6 bg-white p-6 rounded-lg shadow text-black dark:bg-gray-800 dark:text-gray-100">

    <!-- ðŸ”‘ Locations -->
    <h3 class="font-medium mt-2 mb-2 flex items-center gap-2">
      <i class="fa-solid fa-key text-indigo-600"></i>{% trans "Lokasyon" %}
    </h3>
    <ul class="list-disc ml-5 mb-4">
      {% for rental in rentals %}
        <li>
          <strong>Lokasyon #{{ rental.id }}</strong><br>
          {% trans "LokatÃ¨" %} :
          {% if rental.new_user.user_type == "business" %}
            {{ rental.new_user.businessprofile.business_name }}
          {% else %}
            {{ rental.new_user.simple.first_name }} {{ rental.new_user.simple.last_name }}
          {% endif %}<br>
          {% trans "Dat" %} : {{ rental.start_date|date:"d/m/Y" }} â†’ {{ rental.end_date|date:"d/m/Y" }}<br>
          {% trans "Pri" %} : {{ rental.price|intcomma }} HTG
        </li>
      {% empty %}
        <li>{% trans "Pa gen lokasyon." %}</li>
      {% endfor %}
    </ul>

    <!-- ðŸ¤ PrÃªts -->
    <h3 class="font-medium mt-4 mb-2 flex items-center gap-2">
      <i class="fa-solid fa-exchange-alt text-indigo-600"></i>{% trans "Prete" %}
    </h3>
    <ul class="list-disc ml-5 mb-4">
      {% for loan in loans %}
        <li>
          {{ loan.old_user.get_full_name }} â†’
          {{ loan.new_user.get_full_name }}
          ({{ loan.start_date|date:"d/m/Y" }} - {{ loan.end_date|date:"d/m/Y" }})
        </li>
      {% empty %}
        <li>{% trans "Pa gen prÃ¨." %}</li>
      {% endfor %}
    </ul>

    <!-- ðŸ’° Ventes -->
    <h3 class="font-medium mt-4 mb-2 flex items-center gap-2">
      <i class="fa-solid fa-handshake text-indigo-600"></i>{% trans "Vant" %}
    </h3>
    <ul class="list-disc ml-5 mb-4">
      {% for sell in sales %}
        <li>
          {% trans "VandÃ¨" %} :
          {% if sell.old_user.user_type == "business" %}
            {{ sell.old_user.businessprofile.business_name }}<br>
            {{ sell.old_user.email }}<br>
            {{ sell.old_user.businessprofile.patente_number }}
          {% else %}
            {{ sell.old_user.simple.first_name }} {{ sell.old_user.simple.last_name }}<br>
            {{ sell.old_user.email }}<br>
            {{ sell.old_user.simple.driver_license_number }}
          {% endif %}
          <br>
          {% trans "AchtÃ¨" %} :
          {% if sell.new_user.user_type == "business" %}
            {{ sell.new_user.businessprofile.business_name }}<br>
            {{ sell.new_user.email }}<br>
            {{ sell.new_user.businessprofile.patente_number }}
          {% else %}
            {{ sell.new_user.simple.first_name }} {{ sell.new_user.simple.last_name }}<br>
            {{ sell.new_user.email }}<br>
            {{ sell.new_user.simple.driver_license_number }}
          {% endif %}
          <br>
          {% trans "le" %} {{ sell.created_at|date:"d/m/Y" }}<br>
          {% trans "Pri" %} : {{ sell.price|intcomma }} HTG
          {% if sell.warranty_period %}
            ({{ sell.warranty_period }} {% trans "jou garanti" %})
          {% endif %}
        </li>
      {% empty %}
        <li>{% trans "Pa gen vant." %}</li>
      {% endfor %}
    </ul>

    <!-- ðŸ”§ Services -->
    <h3 class="font-medium mt-4 mb-2 flex items-center gap-2">
      <i class="fa-solid fa-wrench text-indigo-600"></i>{% trans "SÃ¨vis Garaj" %}
    </h3>
    <ul class="list-disc ml-5 mb-4">
      {% for service in services %}
        <li>
          {% if service.old_user.user_type == "business" %}
            <strong>Kliyan:</strong> {{ service.old_user.businessprofile.business_name }}<br>
            <strong>No Patant:</strong> {{ service.old_user.businessprofile.patente_number }}
          {% else %}
            <strong>Non:</strong> {{ service.old_user.simple.first_name }}<br>
            <strong>Siyati:</strong> {{ service.old_user.simple.last_name }}<br>
            <strong>No Lisans:</strong> {{ service.old_user.simple.driver_license_number }}
          {% endif %}
          <br>
          <strong>Tip SÃ¨vis:</strong> {{ service.service_type.name }}<br>
          <strong>Dat SÃ¨vis:</strong> {{ service.created_at|date:"d/m/Y" }}<br>
          <strong>Pri SÃ¨vis:</strong> {{ service.price|intcomma }} HTG<br>
          {% if service.new_user.user_type == "business" %}
            <strong>Garaj:</strong> {{ service.new_user.businessprofile.business_name }}<br>
            <strong>No Patant:</strong> {{ service.new_user.businessprofile.patente_number }}
          {% else %}
            <strong>Non:</strong> {{ service.new_user.simple.first_name }}<br>
            <strong>Siyati:</strong> {{ service.new_user.simple.last_name }}<br>
            <strong>No Lisans:</strong> {{ service.new_user.simple.driver_license_number }}
          {% endif %}
        </li>
      {% empty %}
        <li>{% trans "Pa gen sÃ¨vis mekanik." %}</li>
      {% endfor %}
    </ul>

    <!-- ðŸ“Š Historique des statuts -->
    <h3 class="font-medium mt-4 mb-2 flex items-center gap-2">
      <i class="fa-solid fa-chart-line text-indigo-600"></i>{% trans "Chanjman Estati" %}
    </h3>
    <ul class="list-disc ml-5">
      {% for status in status_history %}
        <li>
          {{ status.changed_at|date:"d/m/Y H:i" }} :
          {{ status.old_status|default:"â€”" }} â†’
          {{ status.new_status }}
          {% trans "pa" %} {{ status.changed_by.get_full_name|default:"SistÃ¨m" }}
        </li>
      {% empty %}
        <li>{% trans "Pa gen chanjman estati." %}</li>
      {% endfor %}
    </ul>

  </div>

  <!-- ðŸ”™ Bouton retour -->
  <div class="mt-6">
    <a href="{% url 'vehicles:vehicles_list' %}" class="inline-flex items-center gap-2 text-blue-600 hover:underline">
      <i class="fa-solid fa-arrow-left"></i> {% trans "Retounen sou lis" %}
    </a>
  </div>

</div>
{% endblock %}