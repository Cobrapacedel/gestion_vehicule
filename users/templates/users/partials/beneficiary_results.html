{% load i18n %}

{% if create_new %}
  <div class="p-3 bg-yellow-50 rounded-xl border border-yellow-300">
    <h4 class="font-semibold text-yellow-700 mb-2">
      Aucun bÃ©nÃ©ficiaire trouvÃ© pour "{{ query }}".
    </h4>
    <p class="text-sm text-gray-700 mb-3">
      Voulez-vous crÃ©er un <strong>nouveau client externe</strong> ?
    </p>
    <form 
      hx-post="{% url 'vehiclerental:client_create' %}" 
      hx-target="#search-results" 
      hx-swap="outerHTML"
      class="space-y-2"
    >
      {% csrf_token %}
      <input type="text" name="first_name" placeholder="PrÃ©nom" class="w-full p-2 border rounded-xl" required>
      <input type="text" name="last_name" placeholder="Nom" class="w-full p-2 border rounded-xl" required>
      <input type="text" name="phone" placeholder="TÃ©lÃ©phone" class="w-full p-2 border rounded-xl">
      <input type="text" name="driver_license" placeholder="NumÃ©ro de permis" class="w-full p-2 border rounded-xl">
      <button type="submit" class="w-full bg-green-600 text-white py-2 rounded-xl hover:bg-green-700 transition">
        CrÃ©er le client
      </button>
    </form>
  </div>
{% else %}
  <div class="divide-y divide-gray-200">
    {% if results.users %}
      <h4 class="font-semibold text-gray-600 mb-2">Utilisateurs enregistrÃ©s</h4>
      {% for u in results.users %}
        <div 
          class="p-2 hover:bg-indigo-100 cursor-pointer rounded"
          hx-post="{% url 'loans:set_beneficiary' %}"
          hx-vals='{"beneficiary_type": "user", "beneficiary_id": "{{ u.id }}"}'
          hx-target="#search-results"
          hx-swap="outerHTML"
        >
          ğŸ‘¤ {{ u.get_full_name }} <span class="text-sm text-gray-500">({{ u.email }})</span>
        </div>
      {% endfor %}
    {% endif %}

    {% if results.clients %}
      <h4 class="font-semibold text-gray-600 mt-3 mb-2">Clients externes</h4>
      {% for c in results.clients %}
        <div 
          class="p-2 hover:bg-green-100 cursor-pointer rounded"
          hx-post="{% url 'loans:set_beneficiary' %}"
          hx-vals='{"beneficiary_type": "client", "beneficiary_id": "{{ c.id }}"}'
          hx-target="#search-results"
          hx-swap="outerHTML"
        >
          ğŸ§¾ {{ c.full_name }} <span class="text-sm text-gray-500">({{ c.phone }})</span>
        </div>
      {% endfor %}
    {% endif %}
  </div>
{% endif %}